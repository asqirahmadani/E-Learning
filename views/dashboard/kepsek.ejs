<!DOCTYPE html>
<html lang="id">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Dashboard Kepala Sekolah - E-Learning</title>
   <style>
      /* Your existing CSS styles remain the same */
      * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
      }

      body {
         font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
         background: #f5f7fa;
         min-height: 100vh;
      }

      .header {
         background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
         color: white;
         padding: 1rem 2rem;
         display: flex;
         justify-content: space-between;
         align-items: center;
         box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .user-info {
         display: flex;
         align-items: center;
         gap: 1rem;
      }

      .logout-btn {
         background: rgba(255, 255, 255, 0.2);
         border: 1px solid rgba(255, 255, 255, 0.3);
         color: white;
         padding: 0.5rem 1rem;
         border-radius: 5px;
         cursor: pointer;
         transition: background 0.3s;
      }

      .logout-btn:hover {
         background: rgba(255, 255, 255, 0.3);
      }

      .main-content {
         display: grid;
         grid-template-columns: 250px 1fr;
         min-height: calc(100vh - 80px);
      }

      .sidebar {
         background: white;
         box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
         padding: 2rem 0;
      }

      .nav-item {
         padding: 1rem 2rem;
         cursor: pointer;
         transition: all 0.3s;
         border-left: 3px solid transparent;
      }

      .nav-item:hover,
      .nav-item.active {
         background: #f8f9ff;
         border-left-color: #667eea;
         color: #667eea;
      }

      .content-area {
         padding: 2rem;
      }

      .page-section {
         display: none;
      }

      .page-section.active {
         display: block;
      }

      .stats-grid {
         display: grid;
         grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
         gap: 1.5rem;
         margin-bottom: 2rem;
      }

      .stat-card {
         background: white;
         padding: 2rem;
         border-radius: 10px;
         box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
         text-align: center;
      }

      .stat-value {
         font-size: 2.5rem;
         font-weight: bold;
         color: #667eea;
         margin-bottom: 0.5rem;
      }

      .stat-label {
         color: #666;
         font-size: 0.9rem;
      }

      .card {
         background: white;
         border-radius: 10px;
         padding: 2rem;
         margin-bottom: 1.5rem;
         box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .card-title {
         font-size: 1.2rem;
         font-weight: 600;
         color: #333;
         margin-bottom: 1rem;
      }

      .form-group {
         margin-bottom: 1rem;
      }

      .form-group label {
         display: block;
         margin-bottom: 0.5rem;
         color: #333;
         font-weight: 500;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
         width: 100%;
         padding: 0.75rem;
         border: 2px solid #e1e5e9;
         border-radius: 5px;
         font-size: 1rem;
      }

      .btn {
         background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
         color: white;
         border: none;
         padding: 0.75rem 1.5rem;
         border-radius: 5px;
         cursor: pointer;
         font-weight: 600;
         transition: transform 0.2s;
      }

      .btn:hover {
         transform: translateY(-2px);
      }

      .btn-danger {
         background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      }

      .btn-success {
         background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
      }

      .table {
         width: 100%;
         border-collapse: collapse;
         margin-top: 1rem;
      }

      .table th,
      .table td {
         padding: 1rem;
         text-align: left;
         border-bottom: 1px solid #e1e5e9;
      }

      .table th {
         background: #f8f9ff;
         color: #667eea;
         font-weight: 600;
      }

      .status-active {
         background: #27ae60;
         color: white;
         padding: 0.25rem 0.5rem;
         border-radius: 15px;
         font-size: 0.8rem;
      }

      .status-inactive {
         background: #e74c3c;
         color: white;
         padding: 0.25rem 0.5rem;
         border-radius: 15px;
         font-size: 0.8rem;
      }

      .chart-container {
         width: 100%;
         height: 300px;
         background: white;
         border-radius: 10px;
         padding: 1rem;
         display: flex;
         align-items: center;
         justify-content: center;
         color: #666;
      }

      .alert {
         padding: 1rem;
         border-radius: 5px;
         margin-bottom: 1rem;
         display: none;
      }

      .alert-success {
         background: #d4edda;
         color: #155724;
         border: 1px solid #c3e6cb;
      }

      .alert-error {
         background: #f8d7da;
         color: #721c24;
         border: 1px solid #f5c6cb;
      }

      /* Modal Styles */
      .modal-overlay {
         position: fixed;
         top: 0;
         left: 0;
         width: 100%;
         height: 100%;
         background: rgba(0, 0, 0, 0.5);
         display: flex;
         justify-content: center;
         align-items: center;
         z-index: 1000;
      }

      .modal-content {
         background: white;
         border-radius: 10px;
         width: 90%;
         max-width: 600px;
         max-height: 80vh;
         overflow-y: auto;
         box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .modal-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         padding: 1.5rem;
         border-bottom: 1px solid #e1e5e9;
      }

      .modal-header h3 {
         margin: 0;
         color: #333;
      }

      .modal-close {
         background: none;
         border: none;
         font-size: 1.5rem;
         cursor: pointer;
         color: #666;
         padding: 0;
         width: 30px;
         height: 30px;
         display: flex;
         align-items: center;
         justify-content: center;
      }

      .modal-close:hover {
         color: #333;
      }

      .modal-body {
         padding: 1.5rem;
      }

      /* Tugas List Styles */
      .tugas-list {
         display: flex;
         flex-direction: column;
         gap: 1rem;
      }

      .tugas-item {
         background: #f8f9ff;
         border: 1px solid #e1e5e9;
         border-radius: 8px;
         padding: 1rem;
      }

      .tugas-info {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 0.5rem;
      }

      .tugas-info h4 {
         margin: 0;
         color: #333;
         font-size: 1rem;
      }

      .status-badge {
         padding: 0.25rem 0.75rem;
         border-radius: 15px;
         font-size: 0.8rem;
         font-weight: 600;
         text-transform: capitalize;
      }

      .status-belum_dikerjakan {
         background: #ffeaa7;
         color: #d63031;
      }

      .status-dikerjakan {
         background: #74b9ff;
         color: white;
      }

      .status-selesai {
         background: #00b894;
         color: white;
      }

      .tugas-nilai {
         font-weight: bold;
         color: #667eea;
         margin-top: 0.5rem;
      }

      .tugas-hasil {
         color: #666;
         font-style: italic;
         margin-top: 0.25rem;
      }

      /* Diskusi List Styles */
      .diskusi-list {
         display: flex;
         flex-direction: column;
         gap: 1rem;
      }

      .diskusi-item {
         background: #f8f9ff;
         border: 1px solid #e1e5e9;
         border-radius: 8px;
         padding: 1rem;
      }

      .diskusi-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 0.75rem;
      }

      .diskusi-header strong {
         color: #667eea;
         font-size: 0.9rem;
      }

      .diskusi-date {
         color: #666;
         font-size: 0.8rem;
      }

      .diskusi-content {
         color: #333;
         line-height: 1.5;
         background: white;
         padding: 0.75rem;
         border-radius: 5px;
         border-left: 3px solid #667eea;
      }
   </style>
</head>

<body>
   <!-- Header dengan info user dan logout -->
   <div class="header">
      <div>
         <h1>Dashboard Kepala Sekolah</h1>
         <p>Sistem Manajemen E-Learning</p>
      </div>
      <div class="user-info">
         <span>Selamat datang, <%= user.nama %></span>
         <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
   </div>

   <div class="main-content">
      <!-- Sidebar Navigation -->
      <div class="sidebar">
         <div class="nav-item active" onclick="showSection('dashboard')">üìä Dashboard</div>
         <div class="nav-item" onclick="showSection('guru-management')">üë®‚Äçüè´ Manajemen Guru</div>
         <div class="nav-item" onclick="showSection('siswa-management')">üë®‚Äçüéì Manajemen Siswa</div>
         <div class="nav-item" onclick="showSection('materi-management')">üìö Materi Pembelajaran</div>
         <div class="nav-item" onclick="showSection('diskusi-management')">üí¨ Diskusi Kelas</div>
      </div>

      <div class="content-area">
         <!-- Alert untuk notifikasi -->
         <div id="alert" class="alert">
            <span id="alertMessage"></span>
         </div>

         <!-- Dashboard Overview Section -->
         <div id="dashboard" class="page-section active">
            <h2>Ringkasan Sistem</h2>

            <!-- Statistics Cards -->
            <div class="stats-grid">
               <div class="stat-card">
                  <div class="stat-value" id="totalGuru">-</div>
                  <div class="stat-label">Total Guru</div>
               </div>
               <div class="stat-card">
                  <div class="stat-value" id="totalSiswa">-</div>
                  <div class="stat-label">Total Siswa</div>
               </div>
               <div class="stat-card">
                  <div class="stat-value" id="totalKelas">-</div>
                  <div class="stat-label">Total Kelas</div>
               </div>
               <div class="stat-card">
                  <div class="stat-value" id="totalMateri">-</div>
                  <div class="stat-label">Materi Pembelajaran</div>
               </div>
            </div>

            <!-- Chart untuk aktivitas sistem -->
            <div class="card">
               <div class="card-title">Aktivitas Pembelajaran</div>
               <div class="chart-container">
                  <p>Grafik aktivitas pembelajaran akan ditampilkan di sini</p>
               </div>
            </div>
         </div>

         <!-- Guru Management Section -->
         <div id="guru-management" class="page-section">
            <h2>Manajemen Guru</h2>

            <!-- Form tambah guru -->
            <div class="card">
               <div class="card-title">Tambah Guru Baru</div>
               <form id="addGuruForm">
                  <div class="form-group">
                     <label for="guruNama">Nama Lengkap</label>
                     <input type="text" id="guruNama" name="nama" required>
                  </div>
                  <div class="form-group">
                     <label for="guruEmail">Email</label>
                     <input type="email" id="guruEmail" name="email" required>
                  </div>
                  <div class="form-group">
                     <label for="guruPassword">Password</label>
                     <input type="password" id="guruPassword" name="password" required>
                  </div>
                  <div class="form-group">
                     <label for="guruBidang">Bidang</label>
                     <input type="text" id="guruBidang" name="bidang" placeholder="e.g., Matematika" required>
                  </div>
                  <button type="submit" class="btn">Tambah Guru</button>
               </form>
            </div>

            <!-- Daftar guru -->
            <div class="card">
               <div class="card-title">Daftar Guru</div>
               <table class="table" id="guruTable">
                  <thead>
                     <tr>
                        <th>Nama</th>
                        <th>Email</th>
                        <th>Bidang</th>
                        <th>Status</th>
                        <th>Aksi</th>
                     </tr>
                  </thead>
                  <tbody id="guruTableBody">
                     <!-- Data guru akan dimuat di sini -->
                  </tbody>
               </table>
            </div>
         </div>

         <!-- Siswa Management Section -->
         <div id="siswa-management" class="page-section">
            <h2>Manajemen Siswa</h2>

            <div class="card">
               <div class="card-title">Daftar Siswa</div>
               <table class="table">
                  <thead>
                     <tr>
                        <th>Nama</th>
                        <th>Email</th>
                        <th>Kelas</th>
                        <th>Aksi</th>
                     </tr>
                  </thead>
                  <tbody id="siswaTableBody">
                     <!-- Data siswa akan dimuat di sini -->
                  </tbody>
               </table>
            </div>
         </div>

         <!-- Materi Management Section -->
         <div id="materi-management" class="page-section">
            <h2>Manajemen Materi</h2>

            <div class="card">
               <div class="card-title">Daftar Materi Pembelajaran</div>
               <table class="table">
                  <thead>
                     <tr>
                        <th>Judul Materi</th>
                        <th>Guru Pengampu</th>
                        <th>Tanggal Dibuat</th>
                        <th>Aksi</th>
                     </tr>
                  </thead>
                  <tbody id="materiTableBody">
                     <!-- Data materi akan dimuat di sini -->
                  </tbody>
               </table>
            </div>
         </div>

         <!-- Diskusi Management Section -->
         <div id="diskusi-management" class="page-section">
            <h2>Manajemen Diskusi</h2>

            <!-- Form tambah diskusi -->
            <div class="card">
               <div class="card-title">Tambah Diskusi Kelas</div>
               <form id="addDiskusiForm">
                  <div class="form-group">
                     <label for="diskusiKelas">Kelas</label>
                     <input type="text" id="diskusiKelas" name="kelas" placeholder="e.g., Kelas 1" required>
                  </div>
                  <div class="form-group">
                     <label for="diskusiIsi">Isi Diskusi</label>
                     <textarea id="diskusiIsi" name="isi" rows="4" required></textarea>
                  </div>
                  <button type="submit" class="btn">Tambah Diskusi</button>
               </form>
            </div>

            <!-- Daftar diskusi -->
            <div class="card">
               <div class="card-title">Daftar Diskusi Kelas</div>
               <table class="table">
                  <thead>
                     <tr>
                        <th>Kelas</th>
                        <th>Isi</th>
                        <th>Tanggal</th>
                     </tr>
                  </thead>
                  <tbody id="diskusiTableBody">
                     <!-- Data diskusi akan dimuat di sini -->
                  </tbody>
               </table>
            </div>
         </div>
      </div>
   </div>

   <script>
      // Simulasi data dari backend
      let dashboardData = null;

      // Function untuk menampilkan alert
      function showAlert(message, type = 'success') {
         const alert = document.getElementById('alert');
         const alertMessage = document.getElementById('alertMessage');

         alert.className = `alert alert-${type}`;
         alertMessage.textContent = message;
         alert.style.display = 'block';

         setTimeout(() => {
            alert.style.display = 'none';
         }, 5000);
      }

      // Function untuk menampilkan section
      function showSection(sectionId) {
         document.querySelectorAll('.page-section').forEach(section => {
            section.classList.remove('active');
         });
         document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
         });

         document.getElementById(sectionId).classList.add('active');
         event.target.classList.add('active');

         // Load data untuk section tertentu
         if (sectionId === 'guru-management') {
            loadGuruList();
         } else if (sectionId === 'siswa-management') {
            loadSiswaList();
         } else if (sectionId === 'materi-management') {
            loadMateriList();
         } else if (sectionId === 'diskusi-management') {
            loadDiskusiList();
         }
      }

      // Load dashboard data saat halaman dimuat
      async function loadDashboardData() {
         try {
            // Menggunakan prefix /kepsek sesuai dengan route yang didefinisikan
            const response = await fetch('/kepsek/info-dasar', {
               method: 'GET',
               credentials: 'include'
            });

            if (response.ok) {
               dashboardData = await response.json();
               updateStatistics();
            } else {
               const error = await response.text();
               showAlert('Error loading dashboard: ' + error, 'error');
            }
         } catch (error) {
            console.error('Error loading dashboard:', error);
            showAlert('Terjadi kesalahan saat memuat dashboard', 'error');
         }
      }

      // Update statistics cards
      function updateStatistics() {
         if (dashboardData) {
            document.getElementById('totalGuru').textContent = dashboardData.jumlah_guru || 0;
            document.getElementById('totalSiswa').textContent = dashboardData.jumlah_siswa || 0;
            document.getElementById('totalKelas').textContent = dashboardData.jumlah_kelas || 0;
            document.getElementById('totalMateri').textContent = dashboardData.jumlah_materi || 0;
         }
      }

      // Load daftar guru
      async function loadGuruList() {
         try {
            const response = await fetch('/kepsek/guru/daftar', {
               method: 'GET',
               credentials: 'include'
            });

            if (response.ok) {
               const guruList = await response.json();
               updateGuruTable(guruList);
            } else {
               const error = await response.text();
               showAlert('Error loading guru list: ' + error, 'error');
            }
         } catch (error) {
            console.error('Error loading guru list:', error);
            showAlert('Terjadi kesalahan saat memuat daftar guru', 'error');
         }
      }

      // Update tabel guru
      function updateGuruTable(guruList) {
         const tbody = document.getElementById('guruTableBody');
         tbody.innerHTML = '';

         guruList.forEach(guru => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${guru.nama}</td>
                <td>${guru.email}</td>
                <td>${guru.bidang || '-'}</td>
                <td><span class="status-${guru.status}">${guru.status}</span></td>
                <td>
                    <button class="btn ${guru.status === 'active' ? 'btn-danger' : 'btn-success'}" 
                            onclick="toggleUserStatus(${guru.id}, '${guru.status === 'active' ? 'inactive' : 'active'}')">
                        ${guru.status === 'active' ? 'Nonaktifkan' : 'Aktifkan'}
                    </button>
                    <button class="btn btn-danger" onclick="hapusGuru(${guru.id})" style="margin-left: 5px;">
                        Hapus
                    </button>
                </td>
            `;
            tbody.appendChild(row);
         });
      }

      // Load daftar siswa
      async function loadSiswaList() {
         try {
            const response = await fetch('/kepsek/siswa/daftar', {
               method: 'GET',
               credentials: 'include'
            });

            if (response.ok) {
               const siswaList = await response.json();
               updateSiswaTable(siswaList);
            } else {
               const error = await response.text();
               showAlert('Error loading siswa list: ' + error, 'error');
            }
         } catch (error) {
            console.error('Error loading siswa list:', error);
            showAlert('Terjadi kesalahan saat memuat daftar siswa', 'error');
         }
      }

      // Update tabel siswa
      function updateSiswaTable(siswaList) {
         const tbody = document.getElementById('siswaTableBody');
         tbody.innerHTML = '';

         siswaList.forEach(siswa => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${siswa.nama}</td>
                <td>${siswa.email}</td>
                <td>${siswa.kelas}</td>
                <td>
                    <button class="btn" onclick="lihatTugasSiswa(${siswa.id})">
                        Lihat Tugas
                    </button>
                </td>
            `;
            tbody.appendChild(row);
         });
      }

      // Load daftar materi
      async function loadMateriList() {
         try {
            const response = await fetch('/kepsek/materi/daftar', {
               method: 'GET',
               credentials: 'include'
            });

            if (response.ok) {
               const materiList = await response.json();
               updateMateriTable(materiList);
               document.getElementById('totalMateri').textContent = materiList.length;
            } else {
               const error = await response.text();
               showAlert('Error loading materi list: ' + error, 'error');
            }
         } catch (error) {
            console.error('Error loading materi list:', error);
            showAlert('Terjadi kesalahan saat memuat daftar materi', 'error');
         }
      }

      // Update tabel materi
      function updateMateriTable(materiList) {
         const tbody = document.getElementById('materiTableBody');
         tbody.innerHTML = '';

         materiList.forEach(materi => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${materi.judul}</td>
                <td>${materi.guru || '-'}</td>
                <td>${new Date(materi.created_at).toLocaleDateString()}</td>
                <td>
                    <button class="btn" onclick="lihatDiskusiMateri(${materi.id})">
                        Lihat Diskusi
                    </button>
                </td>
            `;
            tbody.appendChild(row);
         });
      }

      // Load daftar diskusi
      async function loadDiskusiList() {
         try {
            const response = await fetch('/kepsek/kelas/diskusi', {
               method: 'GET',
               credentials: 'include'
            });

            if (response.ok) {
               const diskusiList = await response.json();
               updateDiskusiTable(diskusiList);
            } else {
               const error = await response.text();
               showAlert('Error loading diskusi list: ' + error, 'error');
            }
         } catch (error) {
            console.error('Error loading diskusi list:', error);
            showAlert('Terjadi kesalahan saat memuat daftar diskusi', 'error');
         }
      }

      // Update tabel diskusi
      function updateDiskusiTable(diskusiList) {
         const tbody = document.getElementById('diskusiTableBody');
         tbody.innerHTML = '';

         diskusiList.forEach(diskusi => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${diskusi.kelas}</td>
                <td>${diskusi.isi}</td>
                <td>${new Date(diskusi.created_at).toLocaleDateString()}</td>
            `;
            tbody.appendChild(row);
         });
      }

      // Form submit handler untuk tambah guru
      document.getElementById('addGuruForm').addEventListener('submit', async function (e) {
         e.preventDefault();

         const formData = new FormData(this);
         const guruData = {
            nama: formData.get('nama'),
            email: formData.get('email'),
            password: formData.get('password'),
            bidang: formData.get('bidang')
         };

         try {
            const response = await fetch('/kepsek/guru/tambah', {
               method: 'POST',
               headers: {
                  'Content-Type': 'application/json'
               },
               credentials: 'include',
               body: JSON.stringify(guruData)
            });

            if (response.ok) {
               const result = await response.json();
               showAlert('Guru berhasil ditambahkan!');
               this.reset();
               loadGuruList();
               loadDashboardData(); // Update statistics
            } else {
               const error = await response.json();
               showAlert('Error: ' + error.error, 'error');
            }
         } catch (error) {
            console.error('Error adding guru:', error);
            showAlert('Terjadi kesalahan saat menambah guru', 'error');
         }
      });

      // Form submit handler untuk tambah diskusi
      document.getElementById('addDiskusiForm').addEventListener('submit', async function (e) {
         e.preventDefault();

         const formData = new FormData(this);
         const diskusiData = {
            kelas: formData.get('kelas'),
            isi: formData.get('isi')
         };

         try {
            const response = await fetch('/kepsek/kelas/diskusi', {
               method: 'POST',
               headers: {
                  'Content-Type': 'application/json'
               },
               credentials: 'include',
               body: JSON.stringify(diskusiData)
            });

            if (response.ok) {
               const result = await response.json();
               showAlert('Diskusi berhasil ditambahkan!');
               this.reset();
               loadDiskusiList();
            } else {
               const error = await response.text();
               showAlert('Error: ' + error, 'error');
            }
         } catch (error) {
            console.error('Error adding diskusi:', error);
            showAlert('Terjadi kesalahan saat menambah diskusi', 'error');
         }
      });

      // Toggle status user (aktif/nonaktif)
      async function toggleUserStatus(userId, newStatus) {
         try {
            const response = await fetch(`/kepsek/guru/status/${userId}`, {
               method: 'PATCH',
               headers: {
                  'Content-Type': 'application/json'
               },
               credentials: 'include',
               body: JSON.stringify({
                  status: newStatus
               })
            });

            if (response.ok) {
               showAlert('Status user berhasil diubah!');
               loadGuruList();
            } else {
               const error = await response.text();
               showAlert('Error: ' + error, 'error');
            }
         } catch (error) {
            console.error('Error updating user status:', error);
            showAlert('Terjadi kesalahan saat mengubah status user', 'error');
         }
      }

      // Hapus guru
      async function hapusGuru(userId) {
         if (!confirm('Apakah Anda yakin ingin menghapus guru ini?')) {
            return;
         }

         try {
            const response = await fetch(`/kepsek/guru/hapus/${userId}`, {
               method: 'DELETE',
               credentials: 'include'
            });

            if (response.ok) {
               showAlert('Guru berhasil dihapus!');
               loadGuruList();
               loadDashboardData(); // Update statistics
            } else {
               const error = await response.text();
               showAlert('Error: ' + error, 'error');
            }
         } catch (error) {
            console.error('Error deleting guru:', error);
            showAlert('Terjadi kesalahan saat menghapus guru', 'error');
         }
      }

      // Lihat tugas siswa
      async function lihatTugasSiswa(siswaId) {
         try {
            const response = await fetch(`/kepsek/siswa/tugas/${siswaId}`, {
               method: 'GET',
               credentials: 'include'
            });

            if (response.ok) {
               const tugasList = await response.json();
               let tugasHtml = 'Daftar Tugas:\n\n';
               tugasList.forEach(tugas => {
                  tugasHtml += `‚Ä¢ ${tugas.materi}: ${tugas.status}`;
                  if (tugas.nilai) tugasHtml += ` (Nilai: ${tugas.nilai})`;
                  tugasHtml += '\n';
               });
               alert(tugasHtml);
            } else {
               const error = await response.text();
               showAlert('Error: ' + error, 'error');
            }
         } catch (error) {
            console.error('Error loading tugas siswa:', error);
            showAlert('Terjadi kesalahan saat memuat tugas siswa', 'error');
         }
      }

      // Lihat diskusi materi
      async function lihatDiskusiMateri(materiId) {
         try {
            const response = await fetch(`/kepsek/kelas/diskusi-materi/${materiId}`, {
               method: 'GET',
               credentials: 'include'
            });

            if (response.ok) {
               const diskusiList = await response.json();
               let diskusiHtml = 'Diskusi Materi:\n\n';
               diskusiList.forEach(diskusi => {
                  diskusiHtml += `${diskusi.user} (${diskusi.role}): ${diskusi.isi}\n(${new Date(diskusi.created_at).toLocaleDateString()})\n\n`;
               });
               alert(diskusiHtml || 'Belum ada diskusi untuk materi ini.');
            } else {
               const error = await response.text();
               showAlert('Error: ' + error, 'error');
            }
         } catch (error) {
            console.error('Error loading diskusi materi:', error);
            showAlert('Terjadi kesalahan saat memuat diskusi materi', 'error');
         }
      }

      // Logout function
      async function logout() {
         try {
            const response = await fetch('/logout', {
               method: 'POST',
               credentials: 'include'
            });

            window.location.href = '/login';
         } catch (error) {
            console.error('Logout error:', error);
            window.location.href = '/login';
         }
      }

      // Load data saat halaman dimuat
      document.addEventListener('DOMContentLoaded', function () {
         loadDashboardData();
      });
   </script>
</body>

</html>